"use strict";(self.webpackChunkoperator_for_redis_cluster=self.webpackChunkoperator_for_redis_cluster||[]).push([[125],{3905:function(e,t,r){r.d(t,{Zo:function(){return d},kt:function(){return h}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(r),h=o,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||a;return r?n.createElement(m,i(i({ref:t},d),{},{components:r})):n.createElement(m,i({ref:t},d))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<a;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},3191:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return d},default:function(){return c}});var n=r(7462),o=r(3366),a=(r(7294),r(3905)),i=["components"],l={title:"Home",hide_title:!0,slug:"/"},s=void 0,p={unversionedId:"home",id:"home",title:"Home",description:"logo",source:"@site/docs/home.md",sourceDirName:".",slug:"/",permalink:"/operator-for-redis-cluster/",editUrl:"https://ibm.github.io/operator-for-redis-cluster/docs/home.md",tags:[],version:"current",lastUpdatedAt:1641936115,formattedLastUpdatedAt:"1/11/2022",frontMatter:{title:"Home",hide_title:!0,slug:"/"},sidebar:"docs",next:{title:"Cookbook",permalink:"/operator-for-redis-cluster/cookbook"}},d=[{value:"Project status: alpha",id:"project-status-alpha",children:[],level:2},{value:"Overview",id:"overview",children:[],level:2},{value:"Deployment",id:"deployment",children:[{value:"Environment requirements",id:"environment-requirements",children:[],level:3},{value:"Helm chart deployment",id:"helm-chart-deployment",children:[{value:"Create the RedisCluster",id:"create-the-rediscluster",children:[],level:4}],level:3},{value:"Install kubectl redis-cluster plugin",id:"install-kubectl-redis-cluster-plugin",children:[],level:3},{value:"Deployment from source code",id:"deployment-from-source-code",children:[{value:"Build container images",id:"build-container-images",children:[],level:4}],level:3},{value:"How to Release the Redis Operator",id:"how-to-release-the-redis-operator",children:[],level:3},{value:"How to Upgrade Redis Client Version",id:"how-to-upgrade-redis-client-version",children:[],level:3}],level:2}],u={toc:d};function c(e){var t=e.components,l=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,n.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"logo",src:r(7796).Z})),(0,a.kt)("h2",{id:"project-status-alpha"},"Project status: alpha"),(0,a.kt)("p",null,"This is an ongoing project."),(0,a.kt)("p",null,"The goal of this project is to simplify the deployment and management of a ",(0,a.kt)("a",{parentName:"p",href:"https://redis.io/topics/cluster-tutorial"},"Redis cluster")," in a ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/"},"Kubernetes")," environment. It started internally at Amadeus in 2016, where it was initially designed to run on ",(0,a.kt)("a",{parentName:"p",href:"https://www.openshift.com/"},"Openshift"),". This is the third version of the Redis operator, which leverages the ",(0,a.kt)("a",{parentName:"p",href:"https://sdk.operatorframework.io/"},"Operator SDK")," framework for operators."),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"This project contains two Helm charts, namely ",(0,a.kt)("inlineCode",{parentName:"p"},"operator-for-redis")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"node-for-redis"),". The first chart deploys the Redis operator, ",(0,a.kt)("inlineCode",{parentName:"p"},"RedisCluster")," Custom Resource Definition (CRD), and various other k8s resources. The second chart deploys the ",(0,a.kt)("inlineCode",{parentName:"p"},"RedisCluster")," resource and various other k8s resources. Each node in the Redis cluster runs in its own Pod. Upon startup, each node joins the cluster as a primary node with no slots. See the cluster representation in the diagram below:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Initial state",src:r(5477).Z})),(0,a.kt)("p",null,"At this point, your Redis process is running and each node is aware of each other, but only one primary has all the slots. In order to properly configure each node in the cluster, we introduce the ",(0,a.kt)("inlineCode",{parentName:"p"},"Operator for Redis Cluster"),"."),(0,a.kt)("p",null,"The operator watches the ",(0,a.kt)("inlineCode",{parentName:"p"},"RedisCluster")," CR that stores cluster configuration: number of primaries, replication factor (number of replicas per primary), and the pod template. Then the operator tries to apply this configuration to the set of Redis server processes. If the number of Redis servers doesn't match the provided configuration, the manager scales the number of pods to obtain the proper number of Redis nodes. The operator continuously reconciles the state of the cluster with the configuration stored in the ",(0,a.kt)("inlineCode",{parentName:"p"},"RedisCluster")," CR until they match. To understand how the reconciliation loop works, see the ",(0,a.kt)("a",{parentName:"p",href:"https://sdk.operatorframework.io/docs/building-operators/golang/tutorial/#reconcile-loop"},"Operator SDK docs"),"."),(0,a.kt)("h2",{id:"deployment"},"Deployment"),(0,a.kt)("p",null,"You can follow the ",(0,a.kt)("a",{parentName:"p",href:"/operator-for-redis-cluster/cookbook"},"cookbook")," to deploy the operator and Redis cluster with Minikube."),(0,a.kt)("h3",{id:"environment-requirements"},"Environment requirements"),(0,a.kt)("p",null,"The project may have started on Openshift, but it now supports Kubernetes as well. Please check the minimum environment version in the table below."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Environment"),(0,a.kt)("th",{parentName:"tr",align:null},"Version"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Openshift"),(0,a.kt)("td",{parentName:"tr",align:null},">= 3.7")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes"),(0,a.kt)("td",{parentName:"tr",align:null},">= 1.7")))),(0,a.kt)("h3",{id:"helm-chart-deployment"},"Helm chart deployment"),(0,a.kt)("p",null,"You can find two Helm charts in the ",(0,a.kt)("inlineCode",{parentName:"p"},"charts")," folder:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"operator-for-redis")," used to deploy the operator in your Kubernetes cluster."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"node-for-redis")," used to create the ",(0,a.kt)("inlineCode",{parentName:"li"},"RedisCluster")," CR that will be managed by the operator.")),(0,a.kt)("p",null,"Operator deployment example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"helm install operator-for-redis charts/operator-for-redis\nNAME: operator-for-redis\nLAST DEPLOYED: Fri Aug 13 11:48:29 2021\nNAMESPACE: default\nSTATUS: deployed\n\nRESOURCES:\n==> v1/Deployment\nNAME                DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE\noperator-for-redis  1        1        1           1          10s\n")),(0,a.kt)("h4",{id:"create-the-rediscluster"},"Create the RedisCluster"),(0,a.kt)("p",null,"You can configure the topology of the cluster by editing the provided ",(0,a.kt)("inlineCode",{parentName:"p"},"values.yaml"),", using an override file, and/or setting each value with ",(0,a.kt)("inlineCode",{parentName:"p"},"--set")," when you execute ",(0,a.kt)("inlineCode",{parentName:"p"},"helm install"),"."),(0,a.kt)("p",null,"Redis cluster deployment example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"helm install node-for-redis charts/node-for-redis\nNAME: node-for-redis\nLAST DEPLOYED: Fri Aug 13 11:48:29 2021\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"! Warning !"),', if you want to use the docker images corresponding to the level of code present in the "main" branch. You need to set the image tag when you instantiate the node-for-redis chart and the operator-for-redis-cluster chart. The "latest" tag is corresponding to the last validated release.')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"helm install node-for-redis charts/node-for-redis --set image.tag=main-$COMMIT-dev\n")),(0,a.kt)("h3",{id:"install-kubectl-redis-cluster-plugin"},"Install kubectl redis-cluster plugin"),(0,a.kt)("p",null,"Docs available ",(0,a.kt)("a",{parentName:"p",href:"/operator-for-redis-cluster/kubectl-plugin"},"here"),"."),(0,a.kt)("h3",{id:"deployment-from-source-code"},"Deployment from source code"),(0,a.kt)("h4",{id:"build-container-images"},"Build container images"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"cd $GOPATH/src/github.com/IBM/operator-for-redis-cluster\nmake container\n")),(0,a.kt)("p",null,'you can define the docker images tag by adding the variable "TAG"'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"make TAG=<Your-TAG> container\n")),(0,a.kt)("h3",{id:"how-to-release-the-redis-operator"},"How to Release the Redis Operator"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Do the following in ",(0,a.kt)("inlineCode",{parentName:"p"},"main")," branch:"),(0,a.kt)("ol",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ol"},"Create a tag on commit"),(0,a.kt)("li",{parentName:"ol"},"Push the commit and tag"),(0,a.kt)("li",{parentName:"ol"},"Github actions automation will build and push docker images and helm charts with release version")),(0,a.kt)("p",{parentName:"blockquote"},"NOTE: If you need to test the build prior to the above steps, you can run: ",(0,a.kt)("inlineCode",{parentName:"p"},"make build")," and resolve any issues.")),(0,a.kt)("h3",{id:"how-to-upgrade-redis-client-version"},"How to Upgrade Redis Client Version"),(0,a.kt)("p",null,"To upgrade your Redis client version, you will need to update the ",(0,a.kt)("inlineCode",{parentName:"p"},"REDIS_VERSION")," variable in both the Dockerfile for Redis node and the Github release workflow. Please note that upgrading the Redis client version may impact functionality because the operator depends on the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mediocregopher/radix"},"radix library")," for executing Redis commands."))}c.isMDXComponent=!0},7796:function(e,t,r){t.Z=r.p+"assets/images/logo-34d5aecd76e632e1a7d7bc9e9d9d7c67.png"},5477:function(e,t,r){t.Z=r.p+"assets/images/overview_1-87d24b48af2c162cd54641cd2424229d.png"}}]);