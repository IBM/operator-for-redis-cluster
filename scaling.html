<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Scaling Operations | Operator for Redis Cluster</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://ibm.github.io/operator-for-redis-cluster/scaling"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Scaling Operations | Operator for Redis Cluster"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><link data-react-helmet="true" rel="icon" href="/operator-for-redis-cluster/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ibm.github.io/operator-for-redis-cluster/scaling"><link data-react-helmet="true" rel="alternate" href="https://ibm.github.io/operator-for-redis-cluster/scaling" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ibm.github.io/operator-for-redis-cluster/scaling" hreflang="x-default"><link rel="stylesheet" href="/operator-for-redis-cluster/assets/css/styles.488c9a18.css">
<link rel="preload" href="/operator-for-redis-cluster/assets/js/runtime~main.74806389.js" as="script">
<link rel="preload" href="/operator-for-redis-cluster/assets/js/main.c195b2d0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/operator-for-redis-cluster/"><div class="navbar__logo"><img src="/operator-for-redis-cluster/images/logo.svg" alt="Operator for Redis Cluster" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/operator-for-redis-cluster/images/logo.svg" alt="Operator for Redis Cluster" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Operator for Redis Cluster</b></a></div><div class="navbar__items navbar__items--right"><a href="https://ibm.github.io/operator-for-redis-cluster" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleChecked_a04y toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" checked="" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/cookbook">Cookbook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/kubectl-plugin">Kubectl Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/configuration">Redis Server Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/operator-for-redis-cluster/scaling">Scaling Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/rolling-update">Rolling Update Procedure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/key-migration">Key Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operator-for-redis-cluster/contributing">Contributing</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scaling Operations</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">â€‹</a></h2><p>There are many reasons why you would want to scale the number of Redis nodes in your cluster. A few of the most common reasons are: </p><ul><li>Memory pressure - the nodes in your cluster are close to full capacity (or are at fully capacity and evictions are causing the backend to take more traffic than desired)<ul><li>Horizontally scale the number of primaries to better serve requests</li><li>Vertically scale your current Redis nodes by allocating more memory</li></ul></li><li>CPU bottleneck - throughput is low and impacting system performance<ul><li>Horizontally scale the number of primaries to better serve requests</li><li>Vertically scale your current Redis nodes by allocating more CPUs</li></ul></li><li>Over-provisioning - you have allocated too many resources for your cluster<ul><li>Scale down if it does not hurt the performance of your system</li><li>Scale down the number of primaries to save on costs</li><li>If you are running a Redis cluster with a high replication factor (RF), consider reducing it</li><li>In multi-zone clusters, scaling down may reduce availability in the case of a zone outage</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="impact-of-scaling">Impact of scaling<a class="hash-link" href="#impact-of-scaling" title="Direct link to heading">â€‹</a></h2><p>Scaling operations happen in real-time while the Redis cluster receives requests. They are computationally intensive, so expect a decrease in performance while the scaling operation takes place. The extent of the performance impact depends on the size of the data stored in Redis, as well as CPU utilization. See <a href="/operator-for-redis-cluster/key-migration">key migration</a> for more information about how Redis keys are migrated from one primary to another during the scaling process.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="resource-requirements">Resource Requirements<a class="hash-link" href="#resource-requirements" title="Direct link to heading">â€‹</a></h3><p>Like the rolling update procedure, scaling up requires additional resources to create new Redis pods. In the case where there are insufficient resources to schedule new Redis pods, the pods will get stuck in <code>Pending</code> state. If you find your newly created pods are in <code>Pending</code> state, increase the memory + cpu allocated to your k8s nodes, or add more nodes to your worker pool.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-primaries">Scaling primaries<a class="hash-link" href="#scaling-primaries" title="Direct link to heading">â€‹</a></h2><p>The first option for scaling your cluster is scaling the number of primaries. You can trigger a scaling operation by modifying the <code>numberOfPrimaries</code> field in <code>charts/node-for-redis/values.yaml</code> and running <code>helm upgrade</code> on your cluster.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-up">Scaling up<a class="hash-link" href="#scaling-up" title="Direct link to heading">â€‹</a></h3><p>Scale up operations take place when the desired number of primaries is greater than the current number of primaries. We take the following actions for scale up operations:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">For the number of primaries added</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1.</span><span class="token plain"> Create a </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> Redis pod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">2.</span><span class="token plain"> Wait </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> the pod to become ready</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Once the number of desired Redis pods matches the current number of running pods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">3.</span><span class="token plain"> Check </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> we have sufficient primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> If not</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> promote replicas to primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> This only happens when you scale up the number of primaries AND scale down RF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">4.</span><span class="token plain"> Add the </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> Redis nodes to the selection of current primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">5.</span><span class="token plain"> Place and attach replicas to their respective primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">6.</span><span class="token plain"> Dispatch slots and migrate keys to the </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After this last step, your cluster will be in normal operating state. The primaries nodes will have an equal number of slots and replica nodes will be properly attached.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">â€‹</a></h4><p>Given a Redis cluster with the following config:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">numberOfPrimaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">replicationFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Assuming your helm release name is <code>redis-cluster</code>, scale up <code>numberOfPrimaries</code> by running the following:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm upgrade redis</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cluster charts</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">for</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">redis </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set numberOfPrimaries</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-down">Scaling down<a class="hash-link" href="#scaling-down" title="Direct link to heading">â€‹</a></h3><p>Scale down operations take place when the desired number of primaries is less than the current number of primaries. We take the following actions for scale down operations:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">For the number of primaries deleted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1.</span><span class="token plain"> Select one primary to remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">2.</span><span class="token plain"> Migrate keys from the primary to be removed to the other primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> Slots are equally distributed across the remaining primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">3.</span><span class="token plain"> Detach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> forget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> and </span><span class="token builtin" style="color:rgb(130, 170, 255)">delete</span><span class="token plain"> the primary to be removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Once the number of desired Redis pods matches the current number of running pods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">4.</span><span class="token plain"> Dispatch slots and migrate keys to the </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">5.</span><span class="token plain"> Place and attach replicas to their respective primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After this last step, your cluster will be in normal operating state.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-1">Example<a class="hash-link" href="#example-1" title="Direct link to heading">â€‹</a></h4><p>Given a Redis cluster with the following config:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">numberOfPrimaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">replicationFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Scale down <code>numberOfPrimaries</code> by running the following:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm upgrade redis</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cluster charts</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">for</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">redis </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set numberOfPrimaries</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-replication-factor">Scaling replication factor<a class="hash-link" href="#scaling-replication-factor" title="Direct link to heading">â€‹</a></h2><p>The second option for scaling your cluster is scaling RF. You can trigger a scaling operation by modifying the <code>replicationFactor</code> field in <code>charts/node-for-redis/values.yaml</code> and running <code>helm upgrade</code> on your cluster. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-up-1">Scaling up<a class="hash-link" href="#scaling-up-1" title="Direct link to heading">â€‹</a></h3><p>Scale up operations for RF take place when the desired RF is greater than the current RF. We take the following actions for scale up operations:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">For the number of replicas added</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1.</span><span class="token plain"> Create a </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> Redis pod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">2.</span><span class="token plain"> Wait </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> the pod to become ready</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Once the number of desired Redis pods matches the current number of running pods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">3.</span><span class="token plain"> Add the </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> Redis nodes to the selection of replicas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">4.</span><span class="token plain"> Place and attach replicas to their respective primaries such that each primary has the same number of replicas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">5.</span><span class="token plain"> Dispatch slots and migrate keys to the </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After this step, your cluster will be in normal operating state.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-2">Example<a class="hash-link" href="#example-2" title="Direct link to heading">â€‹</a></h4><p>Given a Redis cluster with the following config:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">numberOfPrimaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">replicationFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Scale up <code>replicationFactor</code> by running the following:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm upgrade redis</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cluster charts</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">for</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">redis </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set replicationFactor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-down-1">Scaling down<a class="hash-link" href="#scaling-down-1" title="Direct link to heading">â€‹</a></h3><p>Scale down operations for RF take place when the desired RF is less than the current RF. We take the following actions for scale down operations:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">For the number of replicas deleted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    For each primary in the cluster</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token number" style="color:rgb(247, 140, 108)">1.</span><span class="token plain"> Calculate the difference between the current RF and desired RF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token number" style="color:rgb(247, 140, 108)">2.</span><span class="token plain"> If we do not have sufficient replicas </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> this primary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">new</span><span class="token plain"> replicas and attach them to the primary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token number" style="color:rgb(247, 140, 108)">3.</span><span class="token plain"> If we have too many replicas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> replicas to </span><span class="token builtin" style="color:rgb(130, 170, 255)">delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> Detach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> forget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> and </span><span class="token builtin" style="color:rgb(130, 170, 255)">delete</span><span class="token plain"> the replica to be removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Once the number of desired Redis pods matches the current number of running pods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">4.</span><span class="token plain"> Place and attach replicas to their respective primaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After this step, your cluster will be in normal operating state.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-3">Example<a class="hash-link" href="#example-3" title="Direct link to heading">â€‹</a></h4><p>Given a Redis cluster with the following config:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">numberOfPrimaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">replicationFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Scale down <code>replicationFactor</code> by running the following:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm upgrade redis</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cluster charts</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">for</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">redis </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set replicationFactor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="scaling-primaries-and-replication-factor">Scaling primaries and replication factor<a class="hash-link" href="#scaling-primaries-and-replication-factor" title="Direct link to heading">â€‹</a></h2><p>You may scale both the number of primaries and replication factor in a single <code>helm upgrade</code> command. The number of pods created or deleted will be calculated and actions will be taken according to the algorithms described in the previous sections. The following is an example of scaling up <code>numberOfPrimaries</code> and <code>replicationFactor</code>.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-1-1">Example 1<a class="hash-link" href="#example-1-1" title="Direct link to heading">â€‹</a></h4><p>Given a Redis cluster with the following config:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">numberOfPrimaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">replicationFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Increase <code>numberOfPrimaries</code> and <code>replicationFactor</code> by running the following:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm upgrade redis</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cluster charts</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">for</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">redis </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set numberOfPrimaries</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set replicationFactor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><hr><h4 class="anchor anchorWithStickyNavbar_y2LR" id="example-2-1">Example 2<a class="hash-link" href="#example-2-1" title="Direct link to heading">â€‹</a></h4><p>You may also scale up one field while scaling down the other:</p><div class="codeBlockContainer_J+bg language-yaml theme-code-block"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">numberOfPrimaries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">replicationFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Increase <code>numberOfPrimaries</code> and decrease <code>replicationFactor</code> by running the following:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI go"><pre tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm upgrade redis</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">cluster charts</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">node</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token keyword" style="font-style:italic">for</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">redis </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set numberOfPrimaries</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">set replicationFactor</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://ibm.github.io/operator-for-redis-cluster/docs/scaling.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-07-13T19:32:24.000Z">7/13/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/operator-for-redis-cluster/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Redis Server Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/operator-for-redis-cluster/rolling-update"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rolling Update Procedure</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#impact-of-scaling" class="table-of-contents__link toc-highlight">Impact of scaling</a><ul><li><a href="#resource-requirements" class="table-of-contents__link toc-highlight">Resource Requirements</a></li></ul></li><li><a href="#scaling-primaries" class="table-of-contents__link toc-highlight">Scaling primaries</a><ul><li><a href="#scaling-up" class="table-of-contents__link toc-highlight">Scaling up</a></li><li><a href="#scaling-down" class="table-of-contents__link toc-highlight">Scaling down</a></li></ul></li><li><a href="#scaling-replication-factor" class="table-of-contents__link toc-highlight">Scaling replication factor</a><ul><li><a href="#scaling-up-1" class="table-of-contents__link toc-highlight">Scaling up</a></li><li><a href="#scaling-down-1" class="table-of-contents__link toc-highlight">Scaling down</a></li></ul></li><li><a href="#scaling-primaries-and-replication-factor" class="table-of-contents__link toc-highlight">Scaling primaries and replication factor</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Operator for Redis Cluster Documentation. Built with Docusaurus.</div></div></div></footer></div>
<script src="/operator-for-redis-cluster/assets/js/runtime~main.74806389.js"></script>
<script src="/operator-for-redis-cluster/assets/js/main.c195b2d0.js"></script>
</body>
</html>